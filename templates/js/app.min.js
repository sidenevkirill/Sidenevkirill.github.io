$(document).ready(function(e){function a(a,n,o,i,r,s){0==n&&(g.currentTrack=-1,a.length>1&&a!=g.oldQuery&&(window.history.pushState(a,e("title").html(),"?q="+a),document.title=a.split(" -")[0]+" - "+g.title),g.oldQuery=a,g.page=0),g.page=n;var c={q:a,page:n};null!=i&&null!=r&&(c.captcha_id=i,c.captcha_key=r,c.captcha_index=s),e.ajax({url:g.apiUrl+"search",data:c,method:"GET",dataType:"json",cache:!0,beforeSend:function(){0==n?e("#loading").show():(e("#load-more").show(),e("#load-more").find(".spinner").show(),e("#load-more").find("span").hide())},error:function(e){l(0!=e.status?i18n.t("serverError"):i18n.t("networkError"))},success:function(o){if("error"==o.status){var i=o.error;return l(i18n.t("error",{error:i.message})),void(14==i.code&&d(i.captcha_id,i.captcha_img,i.captcha_index))}if(0==o.data)return void(0==n?l(i18n.t("notFound")):e("#load-more").hide());0==n&&(g.audios=o.data,e("#result > .list-group").html("")),g.audios.concat(o.data);for(var r=o.data.length,s=0;s<r;s++)audio=o.data[s],downloadUrl=audio.download,streamUrl=audio.stream,audioView={clickToPlay:i18n.t("clickToPlay"),clickToDownload:i18n.t("clickToDownload"),durationSeconds:audio.duration,duration:audio.duration.toTime(),url:{stream:streamUrl,download:{original:downloadUrl,64:downloadUrl+"/64",128:downloadUrl+"/128",192:downloadUrl+"/192"}},title:audio.artist+" - "+audio.title},e("#result > .list-group").append(Mustache.render(y,audioView));p("search",a),e("#loading").hide(),e("#load-more").show(),e("#load-more").find("span").show(),e("#load-more").find(".spinner").hide(),t()}})}function t(){e(".play").on("click",function(a){i(e(".list-group-item").index(e(this).parent()))}),e(".badge-download").on("shown.bs.dropdown",function(){dropdown=e(this),infoEl=e(dropdown.find(".info-link")[0]),link=infoEl.attr("data-stream"),duration=parseInt(e(infoEl).attr("data-duration")),g.bitratesEnabled?"..."==infoEl.text()&&(parts=link.split("/"),length=parts.length,bytesUrl=g.apiUrl+"bytes/"+parts[length-2]+"/"+parts[length-1],u(bytesUrl,function(e){bitrate=parseInt(8*e/duration/1e3),info=bitrate+" kbps, "+h(e,!0),infoEl.text(info),allowedBitrateClasses={64:"bitrate-64",128:"bitrate-128",192:"bitrate-192"};for(var a in allowedBitrateClasses)bitrateEl=dropdown.find("."+allowedBitrateClasses[a]),a>=bitrate?bitrateEl.remove():(bytes=a/8*duration*1e3,bitrateEl.text(bitrateEl.text()+", "+h(bytes,!0)))})):infoEl.text(i18n.t("clickToDownload"))}),e(".badge-download a").on("click",function(){"#"!=e(this).attr("href")&&(e(this).hasClass("info-link")?p("download","bitrate = default"):(bitrate=e(this).text().replace(/[^\d.]/g,""),0==bitrate.length?p("download","bitrate = default"):p("download","bitrate = "+bitrate)))})}function n(){0>g.currentTrack||(itemCount=e(".list-group-item").length-1,g.currentTrack+1<=itemCount?i(g.currentTrack+1):(console.log("seems like there no audios to play, i think. playing first one."),i(0)),p("play","next"))}function o(){0>g.currentTrack||(g.currentTrack-1>=0?i(g.currentTrack-1):(console.log("this is first audio, nothing in back. playing last one."),itemCount=e(".list-group-item").length-1,i(itemCount)),p("play","prev"))}function i(a){return parent=e(e(".list-group-item")[a]),el=parent.find(".play"),a==g.currentTrack?void(e("#jquery_jplayer_1").data().jPlayer.status.paused?(e("#jquery_jplayer_1").jPlayer("play"),e(el).find(".glyphicon").removeClass("glyphicon-play"),e(el).find(".glyphicon").addClass("glyphicon-pause")):(e("#jquery_jplayer_1").jPlayer("pause"),e(el).find(".glyphicon").removeClass("glyphicon-pause"),e(el).find(".glyphicon").addClass("glyphicon-play"))):el.length?(e("#jquery_jplayer_1").jPlayer("setMedia",{mp3:e(el).parent().find("a.name").attr("data-src")}),e(".jp-audio .jp-current-name").text(e(el).parent().find("a.name").text()),e("#jquery_jplayer_1").jPlayer("play"),e("#jp_container_1").show(),e("#player-space").show(),g.currentTrack=a,e(".list-group").find(".glyphicon-pause").each(function(a,t){e(t).removeClass("glyphicon-pause"),e(t).addClass("glyphicon-play")}),e(".list-group-item.active").each(function(a,t){e(t).removeClass("active")}),parent.addClass("active"),e(el).find(".glyphicon").removeClass("glyphicon-play"),e(el).find(".glyphicon").addClass("glyphicon-pause"),p("playAudio",e(e(".list-group-item")[a]).find("a.name").html()),void r(a)):void console.log("#"+a+" audio not found in dom")}function r(e){if("mediaSession"in navigator){var a=g.audios[e];navigator.mediaSession.metadata=new MediaMetadata({title:a.title,artist:a.artist,artwork:[{src:a.cover}]}),navigator.mediaSession.setActionHandler("previoustrack",o),navigator.mediaSession.setActionHandler("nexttrack",n)}}function l(a){e("#result > .list-group").html(""),e("#result > .list-group").append('<li class="list-group-item list-group-item-danger">'+a+"</li>"),e("#loading").hide(),e("#load-more").hide()}function s(){return paramQuery=c("q"),paramQuery.length>1&&(a(paramQuery,0,!0),e("#query").val(paramQuery),!0)}function d(t,n,o){g.captchaProxy&&(n=g.captchaProxyUrl+n),e("#captchaModal").modal("show"),e("#captchaImage").attr("src",n),e("#captchaImage").on("click",function(a){e(this).attr("src",n)}),e("#captchaSend").on("click",function(){e("#captchaModal").modal("hide"),a(e("#query").val(),0,!0,t,e("#captchaKey").val(),o)}),e("#captchaKey").bind("keypress",function(a){13==a.keyCode&&e("#captchaSend").trigger("click")}),p("captcha")}function c(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#]*)"),t=a.exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function u(a,t){e.get(a,function(e){t(parseInt(e))})}function p(e,a){try{ga&&ga("send","event",e,a)}catch(e){console.error("outer",e.message)}}function h(e,a){var t=a?1e3:1024;if(Math.abs(e)<t)return e+" B";var n=a?["kB","MB","GB"]:["KiB","MiB","GiB"],o=-1;do e/=t,++o;while(Math.abs(e)>=t&&o<n.length-1);return e.toFixed(1)+" "+n[o]}e(document).keydown(function(a){if(!e("#query").is(":focus")){var t=a.charCode?a.charCode:a.keyCode;39==t?(n(),p("button","next")):37==t&&(o(),p("button","prev"))}}),e("#player").affix({offset:{top:400,bottom:function(){return this.bottom=e(".footer").outerHeight(!0)}}});var g={title:"datmusic",apiUrl:"https://api.example.com/",appUrl:window.location.protocol+"//example.com/",captchaProxy:!0,captchaProxyUrl:"https://dotjpg.co/timthumb/thumb.php?w=200&src=",bitratesEnabled:!0,oldQuery:null,page:0,langCookie:"language",currentTrack:-1,audios:null};i18n.init({whitelist:["ar","de","en","el","es","fr","it","pt","ru","tr","tk"],fallbackLng:"en",nonExplicitWhitelist:!0,resStore:locales,cookieName:g.langCookie},function(a,t){e("body").i18n(),g.title=i18n.t("title")}),e('[data-toggle="tooltip"]').tooltip();var y=e("#audioTemplate").html();if(Mustache.parse(y),void 0===e.cookie("showAndroidDownload")){e.cookie("showAndroidDownload",!1,{expires:2});var m=navigator.userAgent.toLowerCase(),f=m.indexOf("android")>-1;if(f){var k=confirm(i18n.t("apkDownload"));if(1==k){p("android","confirm");var w=window.open("https://play.google.com/store/apps/details?id=tm.alashow.datmusic","_blank");w.focus()}else p("android","deny")}}if(e("#settings").on("click",function(a){e("#settingsModal").modal("show")}),e("#languageSelect").val(i18n.lng()),e("#languageSelect").on("change",function(a){i18n.setLng(e(this).val(),function(a,t){e("body").i18n(),title=e("#jp_container_1").attr("title"),e("#jp_container_1").attr("data-original-title",title),e("#jp_container_1").attr("title","")})}),e("#query").bind("keypress",function(a){13==a.keyCode&&e(".search").trigger("click")}),e(".search").on("click",function(t){typedQuery=e("#query").val(),""!=typedQuery&&a(typedQuery,0,!0)}),e("#load-more").on("click",function(e){next_page=g.page+1,a(g.oldQuery,next_page,!0),p("load-more",next_page)}),e("#jquery_jplayer_1").jPlayer({swfPath:g.appUrl+"js",supplied:"mp3",wmode:"window",smoothPlayBar:!0,keyEnabled:!0,remainingDuration:!0,toggleDuration:!0,volume:1,keyBindings:{play:{key:32,fn:function(e){p("button","play/pause"),e.status.paused?e.play():e.pause()}}},ended:function(){itemCount=e(".list-group-item").length,console.log("#"+g.currentTrack+" ended, audios count in dom = "+itemCount),n()},play:function(){currentTrackEl=e(e(".list-group-item")[g.currentTrack]).find(".play"),e(el).find(".glyphicon").addClass("glyphicon-pause"),e(el).find(".glyphicon").removeClass("glyphicon-play")},pause:function(){currentTrackEl=e(e(".list-group-item")[g.currentTrack]).find(".play"),e(el).find(".glyphicon").addClass("glyphicon-play"),e(el).find(".glyphicon").removeClass("glyphicon-pause")}}),window.onpopstate=function(e){s()},location.hash.length>2){var v=decodeURIComponent(escape(window.atob(location.hash.substring(1,location.hash.length))));a(v,0,!0),e("#query").val(v)}else if(!s()){var b=["2 Cellos","Agnes Obel","Aloe Black","Andrew Belle","Angus Stone","Aquilo","Arctic Monkeys","Avicii","Balmorhea","Barcelona","Bastille","Ben Howard","Benj Heard","Birdy","Broods","Calvin Harris","Charlotte OC","City of The Sun","Civil Twilight","Clint Mansel","Coldplay","Daft Punk","Damien Rice","Daniela Andrade","Daughter","David O'Dowda","Dawn Golden","Dirk Maassen","Ed Sheeran","Eminem","Fabrizio Paterlini","Fink","Fleurie","Florence and The Machine","Gem club","Glass Animals","Greg Haines","Greg Maroney","Groen Land","Halsey","Hans Zimmer","Hozier","Imagine Dragons","Ingrid Michaelson","Jamie XX","Jarryd James","Jasmin Thompson","Jaymes Young","Jessie J","Josef Salvat","Julia Kent","Kai Engel","Keaton Henson","Kendra Logozar","Kina Grannis","Kodaline","Kygo","Kyle Landry","Lana Del Rey","Lera Lynn","Lights & Motion","Linus Young","Lo-Fang","Lorde","Ludovico Einaudi","M83","MONO","MS MR","Macklemore","Mammals","Maroon 5","Martin Garrix","Mattia Cupelli","Max Richter","Message To Bears","Mogwai","Mumford & Sons","Nils Frahm","ODESZA","Oasis","Of Monsters and Men","Oh Wonder","Philip Glass","Phoebe Ryan","Rachel Grimes","Radiohead","Ryan Keen","Sam Smith","Seinabo Sey","Sia","Takahiro Kido","The Irrepressibles","The Neighbourhood","The xx","VLNY","Wye Oak","X ambassadors","Yann Tiersen","Yiruma","Young Summer","Zack Hemsey","Zinovia","deadmau5","pg.lost","Ólafur Arnalds"],C=b[Math.floor(Math.random()*b.length)];a(C,0,!1),e("#query").val(C)}e.getScript("js/app.extra.js"),Number.prototype.toTime=function(){var e=parseInt(this,10);return(e-(e%=60))/60+(9<e?":":":0")+e}});